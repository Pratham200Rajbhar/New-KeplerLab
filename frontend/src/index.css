@tailwind base;
@tailwind components;
@tailwind utilities;

/* ═══════════════════════════════════════════════════════
   DESIGN SYSTEM — NotebookLM-inspired, production-ready
   Light Mode (default) + Dark Mode (class="dark")
   ═══════════════════════════════════════════════════════ */

/* ==================== CSS CUSTOM PROPERTIES ==================== */
:root {
  /* ── Light Theme (default) ── */
  --surface: #f8f9fb;
  --surface-raised: #ffffff;
  --surface-overlay: #f1f3f5;
  --surface-sunken: #eef0f3;
  --surface-50: #f3f4f6;
  --surface-100: #eceef2;

  --border: #e2e5ea;
  --border-light: #eceef2;
  --border-strong: #d0d4dc;

  --text-primary: #1a1d23;
  --text-secondary: #5f6672;
  --text-muted: #9299a5;
  --text-inverse: #ffffff;

  /* Premium Crisp Blue instead of purplish Indigo */
  --accent: #2563eb;
  --accent-light: #3b82f6;
  --accent-dark: #1d4ed8;
  --accent-subtle: rgba(37, 99, 235, 0.08);
  --accent-muted: rgba(37, 99, 235, 0.18);
  --accent-border: rgba(37, 99, 235, 0.25);

  --backdrop: rgba(0, 0, 0, 0.4);
  --shadow-glass: 0 25px 60px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.06);
  --code-bg: #f8fafc;

  --scrollbar-thumb: rgba(0, 0, 0, 0.12);
  --scrollbar-hover: rgba(0, 0, 0, 0.2);
  --selection: rgba(37, 99, 235, 0.16);
  --focus-ring: rgba(37, 99, 235, 0.4);
}

.dark {
  /* ── Dark Theme ── */
  --surface: #111317;
  --surface-raised: #1a1d24;
  --surface-overlay: #22262e;
  --surface-sunken: #0d0f12;
  --surface-50: #15171c;
  --surface-100: #191c22;

  --border: rgba(255, 255, 255, 0.08);
  --border-light: rgba(255, 255, 255, 0.05);
  --border-strong: rgba(255, 255, 255, 0.14);

  --text-primary: #eceef2;
  --text-secondary: #9299a5;
  --text-muted: #5f6672;
  --text-inverse: #111317;

  /* Premium Crisp Blue */
  --accent: #3b82f6;
  --accent-light: #60a5fa;
  --accent-dark: #2563eb;
  --accent-subtle: rgba(59, 130, 246, 0.1);
  --accent-muted: rgba(59, 130, 246, 0.2);
  --accent-border: rgba(59, 130, 246, 0.3);

  --backdrop: rgba(0, 0, 0, 0.72);
  --shadow-glass: 0 25px 80px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.04);
  --code-bg: linear-gradient(135deg, #111827 0%, #171b26 100%);

  --scrollbar-thumb: rgba(255, 255, 255, 0.1);
  --scrollbar-hover: rgba(255, 255, 255, 0.15);
  --selection: rgba(59, 130, 246, 0.25);
  --focus-ring: rgba(59, 130, 246, 0.5);
}

/* ==================== BASE STYLES ==================== */
@layer base {
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  html,
  body,
  #root {
    height: 100%;
    width: 100%;
  }

  body {
    font-family: "Google Sans", "Inter", system-ui, -apple-system, sans-serif;
    background-color: var(--surface);
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    font-size: 14px;
    line-height: 1.5;
  }

  /* Scrollbar */
  ::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  ::-webkit-scrollbar-track {
    background: transparent;
  }

  ::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 3px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-hover);
  }

  ::selection {
    background: var(--selection);
  }

  :focus-visible {
    outline: 2px solid var(--focus-ring);
    outline-offset: 2px;
  }
}

/* ==================== COMPONENT LAYER ==================== */
@layer components {

  /* ── Panel Surface ── */
  .panel-surface {
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  /* Legacy glass aliases */
  .glass {
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .glass-light {
    background: var(--surface-raised);
    border: 1px solid var(--border-light);
  }

  .glass-strong {
    background: var(--surface-raised);
    border: 1px solid var(--border-strong);
  }

  /* ==================== BUTTONS ==================== */
  .btn {
    @apply inline-flex items-center justify-center gap-2 px-4 py-2 rounded-lg font-medium text-sm transition-all duration-150 ease-out focus:outline-none disabled:opacity-40 disabled:cursor-not-allowed;
  }

  .btn-primary {
    @apply btn text-white;
    background: var(--accent);
  }

  .btn-primary:hover:not(:disabled) {
    background: var(--accent-dark);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 12px var(--accent-muted);
  }

  .btn-primary:active:not(:disabled) {
    transform: scale(0.98);
  }

  .btn-secondary {
    @apply btn;
    color: var(--text-secondary);
    background: var(--surface-overlay);
    border: 1px solid var(--border);
  }

  .btn-secondary:hover:not(:disabled) {
    color: var(--text-primary);
    background: var(--surface-sunken);
    border-color: var(--border-strong);
  }

  .btn-ghost {
    @apply btn bg-transparent;
    color: var(--text-secondary);
  }

  .btn-ghost:hover:not(:disabled) {
    background: var(--accent-subtle);
    color: var(--accent);
  }

  .btn-icon {
    @apply inline-flex items-center justify-center w-9 h-9 rounded-lg transition-all duration-150 focus:outline-none;
    color: var(--text-muted);
  }

  .btn-icon:hover {
    background: var(--accent-subtle);
    color: var(--accent);
  }

  .btn-icon-sm {
    @apply btn-icon w-8 h-8;
  }

  /* ==================== PANELS ==================== */
  .panel {
    @apply h-full overflow-hidden flex flex-col;
    background: var(--surface-raised);
  }

  .panel-header {
    @apply h-[52px] px-4 flex items-center justify-between flex-shrink-0;
    border-bottom: 1px solid var(--border);
  }

  .panel-title {
    @apply text-sm font-medium;
    color: var(--text-primary);
  }

  /* ==================== CARDS ==================== */
  .card {
    @apply rounded-xl transition-all duration-150;
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .card-interactive {
    @apply card cursor-pointer;
  }

  .card-interactive:hover {
    border-color: var(--border-strong);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  .dark .card-interactive:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }

  /* Output Cards */
  .output-card {
    @apply card-interactive p-4 flex items-start gap-4;
  }

  .output-card-icon {
    @apply w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0;
    background: var(--accent-subtle);
    color: var(--accent);
  }

  /* ==================== SOURCE ITEMS ==================== */
  .source-item {
    @apply flex items-center gap-2.5 px-2.5 py-2 rounded-lg transition-all duration-150 cursor-default;
  }

  .source-item:hover {
    background: var(--accent-subtle);
  }

  .source-item.active {
    background: var(--accent-subtle);
    border: 1px solid var(--accent-muted);
  }

  .source-item-checked {
    background: var(--accent-subtle);
    border: 1px solid var(--accent-muted) !important;
  }

  .source-item-checked:hover {
    background: var(--accent-muted);
  }

  /* ── Checkbox ── */
  .source-checkbox {
    @apply w-[18px] h-[18px] rounded flex items-center justify-center cursor-pointer;
    background: var(--surface-overlay);
    border: 1.5px solid var(--border-strong);
    transition: all 0.15s ease-out;
  }

  .source-checkbox:hover {
    border-color: var(--accent);
    background: var(--accent-subtle);
  }

  .source-checkbox-checked {
    background: var(--accent) !important;
    border-color: var(--accent) !important;
    color: white;
  }

  .source-checkbox-partial {
    background: var(--accent-muted);
    border-color: var(--accent) !important;
    color: var(--accent);
  }

  .source-icon {
    @apply w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0;
  }

  /* ==================== CHAT ==================== */

  /* ── Message containers ─────────────────────────── */
  .chat-msg {
    @apply w-full;
  }

  .chat-msg + .chat-msg {
    border-top: 1px solid var(--border-light, rgba(0,0,0,0.04));
  }

  .dark .chat-msg + .chat-msg {
    border-top-color: rgba(255,255,255,0.04);
  }

  /* ── User message ────────────────────────────────── */
  .user-bubble {
    @apply px-4 sm:px-5 py-3 sm:py-3.5 rounded-2xl inline-block;
    background: var(--accent);
    color: #fff;
    border-bottom-right-radius: 6px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.1);
  }

  .dark .user-bubble {
    box-shadow: 0 1px 4px rgba(0,0,0,0.25);
  }

  /* ── AI avatar ───────────────────────────────────── */
  .ai-avatar {
    @apply w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0;
    background: var(--surface-overlay);
    border: 1px solid var(--border);
    color: var(--text-secondary);
  }

  .ai-avatar.streaming-pulse {
    animation: avatarPulse 2s ease-in-out infinite;
  }

  @keyframes avatarPulse {
    0%, 100% { box-shadow: 0 0 0 0 var(--accent-muted); }
    50% { box-shadow: 0 0 0 4px var(--accent-muted); border-color: var(--accent); }
  }

  /* ── AI action bar (copy / thumbs) ───────────────── */
  .ai-action-bar {
    @apply flex items-center gap-0.5;
  }

  /* ── Streaming cursor ────────────────────────────── */
  .streaming-cursor {
    @apply inline-block w-[3px] h-[1.1em] ml-0.5 align-text-bottom;
    background: var(--accent);
    border-radius: 1px;
    animation: cursorBlink 0.8s steps(2) infinite;
  }

  @keyframes cursorBlink {
    0% { opacity: 1; }
    50% { opacity: 0; }
  }

  /* Citations */
  .citation {
    @apply inline-flex items-center gap-1 px-1.5 py-0.5 text-xs font-medium rounded-md cursor-pointer transition-colors;
    background: var(--accent-subtle);
    border: 1px solid var(--accent-muted);
    color: var(--accent);
  }

  .citation:hover {
    background: var(--accent-muted);
  }

  .citation-number {
    @apply inline-flex items-center justify-center w-4 h-4 text-2xs font-semibold rounded;
    background: var(--accent-muted);
    color: var(--accent);
  }

  /* ==================== QUICK ACTIONS ==================== */
  .quick-action {
    @apply flex items-center gap-2 px-3 py-2 rounded-lg text-sm transition-all duration-150 cursor-pointer;
    color: var(--text-secondary);
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .quick-action:hover {
    background: var(--accent-subtle);
    border-color: var(--accent-muted);
    color: var(--accent);
  }

  .quick-action-chip {
    @apply inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-sm bg-transparent transition-all duration-150 cursor-pointer;
    color: var(--text-muted);
    border: 1px solid var(--border);
  }

  .quick-action-chip:hover {
    background: var(--accent-subtle);
    color: var(--accent);
    border-color: var(--accent-muted);
  }

  /* ==================== INPUT ==================== */
  .chat-input {
    @apply w-full px-4 py-3 rounded-xl transition-all duration-150 focus:outline-none;
    color: var(--text-primary);
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .chat-input::placeholder {
    color: var(--text-muted);
  }

  .chat-input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-subtle);
  }

  .chat-input-container {
    @apply flex items-end gap-2 p-2 rounded-xl transition-all duration-150;
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .chat-input-container:focus-within {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-subtle);
  }

  /* Form inputs */
  .input {
    @apply w-full px-3.5 py-2.5 rounded-lg transition-all duration-150 focus:outline-none;
    color: var(--text-primary);
    background: var(--surface);
    border: 1px solid var(--border);
  }

  .input::placeholder {
    color: var(--text-muted);
  }

  .input:focus {
    border-color: var(--accent);
    box-shadow: 0 0 0 3px var(--accent-subtle);
  }

  .textarea {
    @apply input resize-none;
  }

  .form-label {
    @apply block text-sm font-medium mb-1.5;
    color: var(--text-secondary);
  }

  .form-label-hint {
    @apply text-xs font-normal;
    color: var(--text-muted);
  }

  .form-group {
    @apply mb-4;
  }

  /* Chip buttons */
  .chip-group {
    @apply flex flex-wrap gap-2 mb-3;
  }

  .chip {
    @apply px-3 py-1.5 rounded-full text-sm font-medium transition-all duration-150 cursor-pointer;
    background: var(--surface-overlay);
    border: 1.5px solid var(--border);
    color: var(--text-secondary);
  }

  .chip:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .chip.selected {
    border-color: var(--accent);
    background: var(--accent-subtle);
    color: var(--accent);
  }

  /* ==================== MODALS ==================== */
  .modal-backdrop {
    @apply fixed inset-0 flex items-center justify-center;
    z-index: 10000;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  }

  .dark .modal-backdrop {
    background: rgba(0, 0, 0, 0.6);
  }

  .modal {
    @apply rounded-2xl max-h-[90vh] overflow-hidden flex flex-col;
    background: var(--surface-raised);
    border: 1px solid var(--border);
    box-shadow: 0 24px 48px rgba(0, 0, 0, 0.15), 0 0 0 1px var(--border-light);
  }

  .dark .modal {
    box-shadow: 0 24px 48px rgba(0, 0, 0, 0.4), 0 0 0 1px var(--border);
  }

  .modal-header {
    @apply flex items-center justify-between px-6 py-4;
    border-bottom: 1px solid var(--border);
  }

  .modal-body {
    @apply px-6 py-5 overflow-y-auto flex-1;
  }

  .modal-footer {
    @apply flex items-center justify-end gap-3 px-6 py-4;
    border-top: 1px solid var(--border);
  }

  /* Modal animations */
  @keyframes fadeIn {
    from {
      opacity: 0;
    }

    to {
      opacity: 1;
    }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.97) translateY(6px);
    }

    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }

  .animate-fade-in {
    animation: fadeIn 0.2s ease-out;
  }

  .animate-scale-in {
    animation: scaleIn 0.25s cubic-bezier(0.16, 1, 0.3, 1);
  }

  /* ==================== BADGES ==================== */
  .badge {
    @apply inline-flex items-center gap-1 px-2 py-0.5 text-xs font-medium rounded-full;
  }

  .badge-accent {
    background: var(--accent-subtle);
    color: var(--accent);
  }

  .badge-success {
    background: rgba(22, 163, 74, 0.1);
    color: #16a34a;
  }

  .badge-warning {
    background: rgba(217, 119, 6, 0.1);
    color: #d97706;
  }

  .badge-error {
    background: rgba(220, 38, 38, 0.1);
    color: #dc2626;
  }

  /* ==================== DROPZONE ==================== */
  .dropzone {
    @apply flex flex-col items-center justify-center p-8 rounded-xl border-2 border-dashed transition-all duration-200;
    background: var(--surface);
    border-color: var(--border);
  }

  .dropzone-active {
    border-color: var(--accent);
    background: var(--accent-subtle);
  }

  /* ==================== LOADING ==================== */
  .loading-spinner {
    @apply w-5 h-5 rounded-full animate-spin;
    border: 2px solid var(--border);
    border-top-color: var(--accent);
  }

  .typing-indicator {
    @apply flex items-center gap-1;
  }

  .typing-indicator span {
    @apply w-1.5 h-1.5 rounded-full;
    background: var(--text-muted);
    animation: typing 1.5s ease-in-out infinite;
  }

  .typing-indicator span:nth-child(2) {
    animation-delay: 0.15s;
  }

  .typing-indicator span:nth-child(3) {
    animation-delay: 0.3s;
  }

  @keyframes typing {

    0%,
    100% {
      opacity: 0.3;
      transform: scale(0.8);
    }

    50% {
      opacity: 1;
      transform: scale(1);
    }
  }

  /* ==================== PROGRESS ==================== */
  .progress-bar {
    @apply h-1 rounded-full overflow-hidden;
    background: var(--surface-overlay);
  }

  .progress-fill {
    @apply h-full rounded-full transition-all duration-300;
    background: var(--accent);
  }

  /* ==================== DIVIDER ==================== */
  .divider {
    @apply w-full h-px;
    background: var(--border);
  }

  /* ==================== TABS ==================== */
  .tabs {
    @apply flex items-center gap-1 p-1 rounded-lg;
    background: var(--surface-overlay);
  }

  .tab {
    @apply px-4 py-2 text-sm font-medium rounded-md transition-all duration-150;
    color: var(--text-muted);
  }

  .tab:hover {
    color: var(--text-secondary);
  }

  .tab-active {
    background: var(--surface-raised);
    color: var(--text-primary);
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
  }

  .dark .tab-active {
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
  }

  /* ==================== EMPTY STATE ==================== */
  .empty-state {
    @apply flex flex-col items-center justify-center text-center p-8;
  }

  .empty-state-icon {
    @apply w-14 h-14 rounded-xl flex items-center justify-center mb-4;
    background: var(--surface-overlay);
    color: var(--text-muted);
  }

  .empty-state-title {
    @apply text-base font-medium mb-1;
    color: var(--text-primary);
  }

  .empty-state-description {
    @apply text-sm max-w-xs;
    color: var(--text-muted);
  }

  /* ==================== FEATURE CARDS ==================== */
  .feature-card {
    @apply card-interactive p-3 flex items-center gap-3;
    transition: transform 0.15s ease-out, background 0.15s ease-out, border-color 0.15s ease-out, box-shadow 0.15s ease-out;
  }

  .feature-card:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
  }

  .dark .feature-card:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  }

  .feature-card:active {
    transform: translateY(0) scale(0.99);
  }

  .feature-card-icon {
    @apply w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-200;
    background: var(--accent-subtle);
    color: var(--accent);
  }

  .feature-card:hover .feature-card-icon {
    background: var(--accent-muted);
    transform: scale(1.05);
  }

  /* ==================== GENERATION PROGRESS ==================== */
  .gen-progress-root {
    @apply rounded-xl overflow-hidden;
    background: var(--surface-raised);
    border: 1px solid var(--accent-muted);
  }

  .gen-inline-root {
    @apply flex flex-col h-full;
  }

  .gen-progress-hero {
    @apply relative flex flex-col items-center pt-8 pb-5 overflow-hidden;
    background: var(--accent-subtle);
  }

  .gen-progress-orb {
    @apply absolute rounded-full;
    filter: blur(30px);
    opacity: 0.3;
    will-change: transform;
  }

  .gen-progress-orb-1 {
    @apply w-24 h-24;
    background: var(--accent-muted);
    top: -10px;
    left: -10px;
    animation: orbFloat1 4s ease-in-out infinite;
  }

  .gen-progress-orb-2 {
    @apply w-20 h-20;
    background: rgba(139, 92, 246, 0.2);
    top: 10px;
    right: -5px;
    animation: orbFloat2 5s ease-in-out infinite;
  }

  .gen-progress-orb-3 {
    @apply w-16 h-16;
    background: var(--accent-muted);
    bottom: -5px;
    left: 40%;
    animation: orbFloat3 6s ease-in-out infinite;
  }

  @keyframes orbFloat1 {

    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }

    50% {
      transform: translate(12px, 8px) scale(1.15);
    }
  }

  @keyframes orbFloat2 {

    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }

    50% {
      transform: translate(-10px, 6px) scale(1.1);
    }
  }

  @keyframes orbFloat3 {

    0%,
    100% {
      transform: translate(0, 0) scale(1);
    }

    50% {
      transform: translate(8px, -6px) scale(1.2);
    }
  }

  .gen-progress-icon-wrap {
    @apply relative z-10 w-14 h-14 rounded-xl flex items-center justify-center;
    background: var(--accent-muted);
    border: 1px solid var(--accent);
    color: var(--accent);
    animation: iconPulse 2.5s ease-in-out infinite;
  }

  @keyframes iconPulse {

    0%,
    100% {
      box-shadow: 0 0 16px var(--accent-muted);
    }

    50% {
      box-shadow: 0 0 24px var(--accent-muted);
    }
  }

  .gen-progress-bar {
    @apply h-2 rounded-full w-full overflow-hidden;
    background: var(--surface-overlay);
  }

  .gen-progress-bar-shimmer {
    @apply h-full rounded-full relative overflow-hidden;
    width: 100%;
    background: linear-gradient(90deg, transparent 0%, var(--accent) 50%, transparent 100%);
    background-size: 200% 100%;
    animation: shimmerSlide 1.8s ease-in-out infinite;
  }

  @keyframes shimmerSlide {
    0% {
      background-position: -200% 0;
    }

    100% {
      background-position: 200% 0;
    }
  }

  .gen-working-badge {
    @apply inline-flex items-center gap-1.5 text-2xs font-medium px-2 py-0.5 rounded-full;
    color: #16a34a;
    background: rgba(22, 163, 74, 0.08);
    border: 1px solid rgba(22, 163, 74, 0.15);
  }

  .gen-working-dot {
    @apply w-1.5 h-1.5 rounded-full;
    background: #16a34a;
    animation: dotBlink 1.2s ease-in-out infinite;
  }

  @keyframes dotBlink {

    0%,
    100% {
      opacity: 1;
    }

    50% {
      opacity: 0.3;
    }
  }

  .gen-step-indicator {
    @apply w-7 h-7 rounded-full flex items-center justify-center flex-shrink-0 transition-all duration-500 relative z-10;
  }

  .gen-step-done {
    @apply text-white;
    background: var(--accent);
  }

  .gen-step-active {
    background: var(--accent-subtle);
    border: 2px solid var(--accent);
    color: var(--accent);
    animation: stepGlow 2s ease-in-out infinite;
  }

  @keyframes stepGlow {

    0%,
    100% {
      box-shadow: 0 0 8px var(--accent-muted);
    }

    50% {
      box-shadow: 0 0 16px var(--accent-muted);
    }
  }

  .gen-step-pending {
    background: var(--surface-overlay);
    border: 1px solid var(--border);
  }

  .gen-step-pulse {
    @apply w-2 h-2 rounded-full flex-shrink-0 mt-1.5;
    background: var(--accent);
    animation: dotPulse 1.5s ease-in-out infinite;
  }

  @keyframes dotPulse {

    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }

    50% {
      opacity: 0.4;
      transform: scale(0.7);
    }
  }

  /* ==================== MEDIA PLAYER ==================== */
  .media-player-container {
    @apply rounded-xl;
  }

  .audio-bar {
    animation: audioWave 0.8s ease-in-out infinite alternate;
  }

  @keyframes audioWave {
    0% {
      height: 15%;
      opacity: 0.5;
    }

    50% {
      height: 60%;
      opacity: 0.8;
    }

    100% {
      height: 100%;
      opacity: 1;
    }
  }

  .audio-pulse {
    animation: audioPulse 2s ease-in-out infinite;
  }

  @keyframes audioPulse {

    0%,
    100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 var(--accent-muted);
    }

    50% {
      transform: scale(1.01);
      box-shadow: 0 0 16px 4px var(--accent-muted);
    }
  }

  /* ==================== MARKDOWN CONTENT ==================== */
  .markdown-content {
    @apply text-[15px] leading-[1.75];
    color: var(--text-primary);
    word-wrap: break-word;
    overflow-wrap: break-word;
  }

  /* Ensure markdown content children don't overflow */
  .markdown-content > *:first-child {
    margin-top: 0 !important;
  }

  .markdown-content > *:last-child {
    margin-bottom: 0 !important;
  }

  .md-heading {
    @apply font-semibold;
    color: var(--text-primary);
  }

  .md-h1 {
    @apply text-xl mt-6 mb-4 pb-2.5 font-bold leading-tight tracking-tight relative;
    color: var(--text-primary);
  }
  .md-h1::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 32px;
    height: 2px;
    background: var(--accent);
    border-radius: 1px;
  }

  .md-h1:first-child {
    margin-top: 0;
  }

  .md-h2 {
    @apply text-[17px] mt-6 mb-3 font-semibold;
    color: var(--text-primary);
  }

  .md-h3 {
    @apply text-[15px] mt-5 mb-2.5 font-semibold;
    color: var(--text-primary);
  }

  .md-h4 {
    @apply text-sm mt-4 mb-2 font-medium uppercase tracking-wider;
    color: var(--text-secondary);
  }

  .md-heading-icon {
    @apply text-base;
  }

  .md-paragraph {
    @apply mb-3 leading-[1.75];
    color: var(--text-secondary);
  }

  .md-paragraph:last-child {
    @apply mb-0;
  }

  .md-list {
    @apply mb-4 space-y-1.5 pl-1;
  }

  .md-ul {
    list-style: none;
  }

  .md-ol {
    list-style: none;
    counter-reset: list-counter;
  }

  .md-list-item {
    @apply relative pl-6 leading-[1.75];
    color: var(--text-secondary);
  }

  .md-ul>.md-list-item::before {
    content: '';
    @apply absolute left-0 top-[0.65em] w-1.5 h-1.5 rounded-full;
    background: var(--text-muted);
  }

  .md-ol>.md-list-item {
    counter-increment: list-counter;
  }

  .md-ol>.md-list-item::before {
    content: counter(list-counter) ".";
    @apply absolute left-0 top-0 text-sm font-medium;
    color: var(--text-muted);
  }

  .md-code-block-wrapper {
    @apply my-4 rounded-xl overflow-hidden;
    border: 1px solid var(--border);
  }

  .md-code-header {
    @apply flex items-center justify-between px-4 py-2;
    background: var(--surface-overlay);
    border-bottom: 1px solid var(--border);
  }

  .md-code-language {
    @apply text-xs font-medium uppercase tracking-wider;
    color: var(--text-muted);
  }

  .copy-code-btn {
    @apply flex items-center justify-center w-7 h-7 rounded-md transition-all duration-200;
    color: var(--text-muted);
    background: transparent;
  }

  .copy-code-btn:hover {
    color: var(--text-primary);
    background: var(--surface-overlay);
  }

  .md-inline-code {
    @apply px-1.5 py-0.5 rounded-md text-[13px] font-mono;
    background: var(--surface-overlay);
    color: var(--text-primary);
    border: 1px solid var(--border-light);
  }

  .md-blockquote {
    @apply my-4 py-3 px-4 rounded-lg;
    border-left: 3px solid var(--accent);
    background: var(--surface-raised);
  }

  .md-blockquote-content {
    @apply flex-1;
  }

  .md-blockquote-content p {
    @apply mb-0 leading-relaxed;
    color: var(--text-secondary);
  }

  .md-link {
    @apply inline-flex items-center font-medium transition-colors duration-150;
    color: var(--accent);
    text-decoration: underline;
    text-decoration-color: var(--accent-muted);
    text-underline-offset: 2px;
  }

  .md-link:hover {
    color: var(--accent-dark);
    text-decoration-color: var(--accent);
  }

  .md-table-wrapper {
    @apply my-4 rounded-xl overflow-x-auto;
    border: 1px solid var(--border);
    -webkit-overflow-scrolling: touch;
  }

  .md-table {
    @apply w-full text-sm;
    border-collapse: collapse;
  }

  .md-thead {
    background: var(--surface-raised);
  }

  .md-th {
    @apply px-4 py-2.5 text-left font-semibold text-xs uppercase tracking-wider;
    color: var(--text-secondary);
    border-bottom: 1px solid var(--border);
  }

  .md-tbody .md-tr {
    @apply transition-colors duration-100;
    border-bottom: 1px solid var(--border-light);
  }

  .md-tbody .md-tr:last-child {
    border-bottom: none;
  }

  .md-tbody .md-tr:hover {
    background: var(--surface-raised);
  }

  .md-td {
    @apply px-4 py-2.5;
    color: var(--text-secondary);
  }

  .md-strong {
    @apply font-semibold;
    color: var(--text-primary);
  }

  .md-em {
    @apply italic;
    color: var(--text-secondary);
  }

  .md-del {
    @apply line-through;
    color: var(--text-muted);
  }

  .md-hr {
    @apply my-6 border-0 h-px;
    background: var(--border);
  }

  .md-image-wrapper {
    @apply my-4 flex flex-col items-center;
  }

  .md-image {
    @apply max-w-full rounded-xl;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
    border: 1px solid var(--border);
  }

  .md-image-caption {
    @apply mt-2 text-xs text-center;
    color: var(--text-muted);
  }

  /* ── Task lists (GFM checkboxes) ─────────────────── */
  .md-task-list {
    list-style: none !important;
    padding-left: 0 !important;
  }

  .md-task-item {
    @apply flex items-start gap-2 pl-0;
  }

  .md-task-item::before {
    display: none !important;
  }

  .md-task-checkbox {
    @apply mt-1.5 w-4 h-4 rounded border-2 flex-shrink-0 cursor-default appearance-none;
    border-color: var(--border);
    background: var(--surface-overlay);
    transition: all 0.15s ease;
  }

  .md-task-checkbox:checked {
    background: var(--accent);
    border-color: var(--accent);
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3E%3C/svg%3E");
    background-size: 100%;
    background-position: center;
    background-repeat: no-repeat;
  }

  /* ── Details / Summary (collapsible) ─────────────── */
  .md-details {
    @apply my-3 rounded-xl overflow-hidden;
    border: 1px solid var(--border);
    background: var(--surface-raised);
  }

  .md-summary {
    @apply px-4 py-2.5 text-sm font-medium cursor-pointer select-none;
    color: var(--text-primary);
    list-style: none;
  }

  .md-summary::-webkit-details-marker {
    display: none;
  }

  .md-summary::before {
    content: '▸';
    @apply mr-2 inline-block transition-transform duration-200;
    color: var(--text-muted);
  }

  .md-details[open] > .md-summary::before {
    transform: rotate(90deg);
  }

  .md-details > :not(summary) {
    @apply px-4 pb-3;
  }

  /* ── Heading improvements ────────────────────────── */
  .md-h5 {
    @apply text-sm mt-4 mb-2 font-semibold;
    color: var(--text-primary);
  }

  .md-h6 {
    @apply text-xs mt-3 mb-1.5 font-semibold uppercase tracking-widest;
    color: var(--text-muted);
  }

  /* ── Nested lists ────────────────────────────────── */
  .md-list .md-list {
    @apply mt-1 mb-0;
  }

  .md-ul .md-ul > .md-list-item::before {
    @apply rounded-none w-1.5 h-[2px];
    border-radius: 1px;
  }

  .md-ol .md-ol {
    counter-reset: list-counter;
  }

  /* ── Superscript / subscript ─────────────────────── */
  .md-sup {
    @apply text-xs align-super;
    color: var(--accent);
  }

  .md-sub {
    @apply text-xs align-sub;
    color: var(--text-muted);
  }

  /* ── KaTeX math overrides ────────────────────────── */
  .markdown-content .katex-display {
    @apply my-4 overflow-x-auto py-2;
  }

  .markdown-content .katex {
    font-size: 1.05em;
    color: var(--text-primary);
  }

  .markdown-content .katex-display > .katex {
    font-size: 1.15em;
  }

  /* ── Overflow handling for code and tables ────────── */
  .markdown-content pre {
    @apply overflow-x-auto;
  }

  /* ── Paragraph spacing inside lists ──────────────── */
  .md-list-item > .md-paragraph {
    @apply mb-1;
  }

  .md-list-item > .md-paragraph:last-child {
    @apply mb-0;
  }

  /* ── Blockquote nested elements ──────────────────── */
  .md-blockquote .md-blockquote {
    @apply ml-2 my-2;
    border-left-color: var(--text-muted);
  }

  .md-blockquote .md-code-block-wrapper {
    @apply my-2;
  }

  /* ==================== AUTH PAGES ==================== */
  .auth-container {
    @apply min-h-screen flex items-center justify-center;
    background: var(--surface);
  }

  .auth-card {
    @apply w-full max-w-md p-8 rounded-2xl;
    background: var(--surface-raised);
    border: 1px solid var(--border);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  }

  .dark .auth-card {
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
  }

  /* ==================== NOTEBOOK CARDS ==================== */
  .notebook-card {
    @apply h-48 rounded-xl cursor-pointer transition-all duration-200 relative overflow-hidden flex flex-col;
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .notebook-card:hover {
    border-color: var(--accent-muted);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
    transform: translateY(-1px);
  }

  .dark .notebook-card:hover {
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
  }

  /* ==================== AGENT MODE BADGE ==================== */
  .agent-mode-badge {
    background: var(--accent-subtle);
    border: 1px solid var(--accent-muted);
    color: var(--accent);
  }

  .agent-mode-dot {
    @apply w-1.5 h-1.5 rounded-full;
    background: var(--accent);
    animation: typing 2s ease-in-out infinite;
  }

  /* ==================== SUGGESTION DROPDOWN ==================== */
  .suggestion-dropdown {
    @apply absolute bottom-full mb-2 w-full z-50 rounded-xl overflow-hidden;
    background: var(--surface-raised);
    border: 1px solid var(--border-strong);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.14), 0 0 0 1px var(--border-light);
    animation: scaleIn 0.18s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .suggestion-dropdown-header {
    @apply flex items-center justify-between px-3 py-2;
    border-bottom: 1px solid var(--border-light);
  }

  .suggestion-label {
    @apply text-xs font-medium;
    color: var(--accent);
  }

  .suggestion-spinner {
    @apply w-3 h-3 rounded-full animate-spin;
    border: 1.5px solid var(--border);
    border-top-color: var(--accent);
  }

  .suggestion-list {
    @apply py-1 list-none;
  }

  .suggestion-item {
    @apply flex flex-col gap-1 px-3 py-2.5 cursor-pointer transition-colors;
    color: var(--text-primary);
  }

  .suggestion-item:hover,
  .suggestion-item-active {
    background: var(--accent-subtle);
  }

  .suggestion-text {
    @apply text-sm leading-snug;
  }

  .confidence-bar-wrapper {
    @apply h-0.5 w-full rounded-full overflow-hidden;
    background: var(--surface-overlay);
  }

  .confidence-bar-fill {
    @apply h-full rounded-full transition-all;
    background: var(--accent);
    opacity: 0.5;
  }

  /* ==================== AGENT STEPS PANEL ==================== */
  .agent-steps-panel {
    @apply mt-3 rounded-xl overflow-hidden text-xs;
    border-left: 2px solid var(--accent-muted);
    background: var(--surface-overlay);
    border: 1px solid var(--border-light);
  }

  .agent-steps-toggle {
    @apply flex items-center gap-2 w-full px-3 py-2 text-left transition-colors;
    color: var(--text-muted);
    background: transparent;
  }

  .agent-steps-toggle:hover {
    background: var(--surface-sunken);
    color: var(--text-secondary);
  }

  .agent-steps-chevron {
    @apply text-[10px] transition-transform duration-200;
    color: var(--text-muted);
  }

  .agent-steps-title {
    @apply text-xs font-medium;
    color: var(--text-secondary);
  }

  .agent-confidence {
    @apply ml-auto text-xs;
    color: var(--text-muted);
  }

  .agent-steps-body {
    @apply px-3 pb-3 pt-1 flex flex-col gap-1.5;
    border-top: 1px solid var(--border-light);
  }

  .agent-step-row {
    @apply flex items-center gap-1.5 flex-wrap;
    color: var(--text-muted);
  }

  .agent-step-check {
    @apply text-xs;
  }

  .agent-step-warn {
    @apply text-xs;
  }

  .agent-step-label {
    @apply text-xs;
    color: var(--text-muted);
  }

  .agent-step-value {
    @apply text-xs font-medium;
    color: var(--text-secondary);
  }

  .agent-step-sep {
    @apply text-xs;
    color: var(--border-strong);
  }

  .agent-step-warn-text {
    color: #d97706;
  }

  /* Intent badges */
  .intent-badge {
    @apply inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[10px] font-medium;
  }

  .intent-question {
    background: rgba(79, 110, 247, 0.1);
    color: var(--accent);
  }

  .intent-data {
    background: rgba(22, 163, 74, 0.1);
    color: #16a34a;
  }

  .intent-research {
    background: rgba(139, 92, 246, 0.1);
    color: #7c3aed;
  }

  .intent-code {
    background: rgba(234, 88, 12, 0.1);
    color: #ea580c;
  }

  .intent-content {
    background: rgba(219, 39, 119, 0.1);
    color: #db2777;
  }

  .intent-unknown {
    background: var(--surface-overlay);
    color: var(--text-muted);
  }

  .intent-error {
    background: rgba(220, 38, 38, 0.1);
    color: #dc2626;
  }

  /* ==================== EXECUTION PANEL ==================== */
  .execution-panel {
    @apply mt-4 rounded-xl overflow-hidden;
    border: 1px solid var(--border);
    background: var(--surface-raised);
  }

  .execution-header {
    @apply flex items-center justify-between px-4 py-2.5;
    background: var(--surface-overlay);
    border-bottom: 1px solid var(--border-light);
  }

  .execution-header-left {
    @apply flex items-center gap-2;
  }

  .execution-icon {
    @apply text-sm;
  }

  .execution-title {
    @apply text-sm font-medium;
    color: var(--text-primary);
  }

  .execution-lang {
    @apply text-xs px-1.5 py-0.5 rounded font-mono;
    background: var(--accent-subtle);
    color: var(--accent);
  }

  .execution-collapse-btn {
    @apply text-xs transition-colors;
    color: var(--text-muted);
  }

  .execution-collapse-btn:hover {
    color: var(--text-secondary);
  }

  .execution-code>div {
    border-radius: 0 !important;
  }

  .execution-actions {
    @apply flex items-center gap-3 px-4 py-3;
    border-top: 1px solid var(--border-light);
  }

  .execution-run-btn {
    @apply inline-flex items-center gap-2 px-4 py-1.5 rounded-lg text-sm font-medium transition-all;
    background: var(--accent);
    color: white;
  }

  .execution-run-btn:hover:not(:disabled) {
    background: var(--accent-dark);
    box-shadow: 0 0 12px var(--accent-muted);
  }

  .execution-run-btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .execution-run-btn--running {
    background: var(--surface-overlay);
    color: var(--text-secondary);
  }

  .execution-spinner {
    @apply w-3 h-3 rounded-full animate-spin inline-block;
    border: 1.5px solid var(--border);
    border-top-color: var(--accent);
  }

  .execution-exit-badge {
    @apply px-2 py-0.5 rounded text-xs font-mono font-medium;
  }

  .exit-ok {
    background: rgba(22, 163, 74, 0.1);
    color: #16a34a;
  }

  .exit-err {
    background: rgba(220, 38, 38, 0.1);
    color: #dc2626;
  }

  /* ==================== TERMINAL BOX ==================== */
  .terminal-box {
    @apply overflow-y-auto max-h-[200px] m-0;
    background: #0d1117;
    border-top: 1px solid rgba(255, 255, 255, 0.08);
  }

  .terminal-header {
    @apply flex items-center gap-2 px-4 py-2 text-xs font-medium sticky top-0;
    background: #0d1117;
    color: rgba(255, 255, 255, 0.4);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
  }

  .terminal-icon {
    @apply text-xs;
  }

  .terminal-running-dot {
    @apply w-1.5 h-1.5 rounded-full ml-auto;
    background: #22c55e;
    animation: typing 1s ease-in-out infinite;
  }

  .terminal-content {
    @apply px-4 py-3 text-xs font-mono leading-relaxed whitespace-pre-wrap;
    color: #22c55e;
  }

  /* ==================== CHART RENDERER ==================== */
  .chart-renderer {
    @apply mt-4 rounded-xl overflow-hidden;
    border: 1px solid var(--border);
    background: var(--surface-raised);
  }

  .chart-header {
    @apply flex items-center gap-2 px-4 py-2.5;
    background: var(--surface-overlay);
    border-bottom: 1px solid var(--border-light);
  }

  .chart-icon {
    @apply text-sm;
  }

  .chart-title {
    @apply text-sm font-medium;
    color: var(--text-primary);
  }

  .chart-image-wrapper {
    @apply p-4 flex justify-center;
    background: var(--surface-raised);
  }

  .chart-image {
    @apply max-w-full rounded-lg cursor-zoom-in;
    max-height: 400px;
    object-fit: contain;
  }

  .chart-actions {
    @apply flex items-center gap-2 px-4 py-2.5;
    border-top: 1px solid var(--border-light);
  }

  .chart-btn {
    @apply inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-medium transition-colors;
    color: var(--text-secondary);
    background: var(--surface-overlay);
    border: 1px solid var(--border);
  }

  .chart-btn:hover {
    color: var(--accent);
    border-color: var(--accent-muted);
    background: var(--accent-subtle);
  }

  .chart-insight {
    @apply flex items-start gap-2.5 px-4 py-3 mt-0;
    background: var(--accent-subtle);
    border-top: 1px solid var(--accent-muted);
  }

  .chart-insight-icon {
    @apply text-sm mt-0.5 flex-shrink-0;
  }

  .chart-insight-text {
    @apply text-sm leading-relaxed;
    color: var(--text-secondary);
  }

  /* Chart expand modal */
  .chart-modal-backdrop {
    @apply fixed inset-0 z-[9999] flex items-center justify-center;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(8px);
    animation: fadeIn 0.15s ease-out;
  }

  .chart-modal {
    @apply relative max-w-4xl w-full mx-4 rounded-2xl overflow-hidden flex flex-col;
    background: var(--surface-raised);
    border: 1px solid var(--border);
    max-height: 90vh;
  }

  .chart-modal-close {
    @apply absolute top-3 right-3 w-8 h-8 rounded-full flex items-center justify-center z-10 text-sm transition-colors;
    background: var(--surface-overlay);
    color: var(--text-muted);
  }

  .chart-modal-close:hover {
    color: var(--text-primary);
  }

  .chart-modal-image {
    @apply w-full object-contain;
    max-height: 70vh;
  }

  .chart-modal-insight {
    @apply px-5 py-3 text-sm;
    color: var(--text-secondary);
    border-top: 1px solid var(--border-light);
  }

  /* ==================== BLOCK HOVER MENU ==================== */
  .block-hover-wrapper {
    @apply relative mb-1 transition-colors duration-200;
  }

  .block-hover-content {
    @apply relative;
  }

  .block-hover-actions {
    @apply flex items-center flex-wrap gap-2 mt-2;
    animation: fadeIn 0.15s ease-out;
  }

  .block-action-btn {
    @apply flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium transition-all;
    background: var(--surface-raised);
    border: 1px solid var(--border);
    color: var(--text-secondary);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
    cursor: pointer;
  }

  .dark .block-action-btn {
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
  }

  .block-action-btn:hover {
    background: var(--accent-subtle);
    border-color: var(--accent-muted);
    color: var(--accent);
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.06);
  }

  .dark .block-action-btn:hover {
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }

  .block-hover-lang-wrapper {
    @apply relative flex items-center justify-center;
  }

  .lang-picker {
    @apply absolute top-full left-0 mt-2 w-36 rounded-xl overflow-hidden z-30 py-1;
    background: var(--surface-raised);
    border: 1px solid var(--border-strong);
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
    animation: scaleIn 0.15s cubic-bezier(0.16, 1, 0.3, 1);
    transform-origin: top left;
  }

  .dark .lang-picker {
    box-shadow: 0 12px 32px rgba(0, 0, 0, 0.5);
  }

  .lang-picker-item {
    @apply w-full text-left px-4 py-2 text-xs transition-colors;
    color: var(--text-primary);
  }

  .lang-picker-item:hover {
    background: var(--accent-subtle);
    color: var(--accent);
  }

  /* Custom scrollbar for small dropdowns */
  .custom-scrollbar::-webkit-scrollbar {
    width: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-track {
    background: transparent;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb {
    background: var(--border-strong);
    border-radius: 4px;
  }

  .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background: var(--text-muted);
  }

  /* ==================== MINI BLOCK CHAT ==================== */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .animate-slide-down {
    animation: slideDown 0.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .mini-block-chat {
    @apply mt-3 rounded-xl overflow-hidden;
    background: var(--surface-raised);
    border: 1px solid var(--accent-muted);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08), 0 0 0 1px var(--accent-border);
  }

  .mini-block-chat-header {
    @apply flex items-center justify-between px-3 py-2;
    background: var(--accent-subtle);
    border-bottom: 1px solid var(--accent-muted);
  }

  .mini-block-chat-title {
    @apply text-xs font-medium;
    color: var(--accent);
  }

  .mini-block-close-btn {
    @apply w-5 h-5 flex items-center justify-center text-xs rounded transition-colors;
    color: var(--text-muted);
  }

  .mini-block-close-btn:hover {
    background: var(--surface-overlay);
    color: var(--text-primary);
  }

  .mini-block-input-row {
    @apply flex items-center gap-2 px-3 py-2;
  }

  .mini-block-input {
    @apply flex-1 text-sm outline-none px-0 py-1;
    background: transparent;
    color: var(--text-primary);
    border: none;
  }

  .mini-block-input::placeholder {
    color: var(--text-muted);
  }

  .mini-block-send-btn {
    @apply w-7 h-7 flex items-center justify-center rounded-lg text-sm font-bold transition-all flex-shrink-0;
    background: var(--accent);
    color: white;
  }

  .mini-block-send-btn:disabled {
    opacity: 0.4;
  }

  .mini-block-send-btn:hover:not(:disabled) {
    background: var(--accent-dark);
  }

  .mini-block-response {
    @apply px-3 py-3;
    border-top: 1px solid var(--border-light);
  }

  .mini-block-response-text {
    @apply text-sm leading-relaxed;
    color: var(--text-secondary);
  }

  .mini-block-actions-bar {
    @apply flex gap-2 mt-2;
  }

  .mini-block-btn {
    @apply text-xs px-2.5 py-1 rounded-lg transition-colors;
    color: var(--text-muted);
    background: var(--surface-overlay);
    border: 1px solid var(--border);
  }

  .mini-block-btn:hover {
    color: var(--accent);
    border-color: var(--accent-muted);
  }

  /* ==================== RESEARCH PROGRESS ==================== */
  .research-progress {
    @apply rounded-xl p-4;
    background: var(--surface-raised);
    border: 1px solid var(--border);
  }

  .research-progress-header {
    @apply flex items-start gap-3 mb-4;
  }

  .research-icon {
    @apply text-xl flex-shrink-0 mt-0.5;
  }

  .research-title {
    @apply text-sm font-semibold;
    color: var(--text-primary);
  }

  .research-query {
    @apply text-xs mt-0.5;
    color: var(--text-muted);
  }

  .research-steps {
    @apply flex flex-col gap-2 pl-2;
    border-left: 2px solid var(--accent-muted);
  }

  .research-step {
    @apply flex items-center gap-2.5 text-xs transition-colors;
  }

  .research-step--done {
    color: var(--text-secondary);
  }

  .research-step--active {
    color: var(--text-primary);
    font-weight: 500;
  }

  .research-step--pending {
    color: var(--text-muted);
    opacity: 0.6;
  }

  .research-step-indicator {
    @apply flex items-center justify-center w-4 h-4 flex-shrink-0 text-xs;
  }

  .research-pulse-dot {
    @apply w-2 h-2 rounded-full;
    background: var(--accent);
    animation: pulse-dot 1.2s ease-in-out infinite;
  }

  @keyframes pulse-dot {

    0%,
    100% {
      opacity: 1;
      transform: scale(1);
    }

    50% {
      opacity: 0.5;
      transform: scale(0.7);
    }
  }

  .research-step-label {
    @apply leading-none;
  }

  /* ==================== RESEARCH BUTTON ==================== */
  .research-btn:not(:disabled):hover {
    background: rgba(139, 92, 246, 0.1) !important;
    color: #7c3aed !important;
    box-shadow: 0 0 10px rgba(139, 92, 246, 0.2);
  }
}