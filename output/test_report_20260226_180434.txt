======================================================================
KeplerLab-AI-Notebook — Test Report
Generated: 2026-02-26 18:04:34
======================================================================

  [PASS]  test/unit/test_auth_schemas.py                                (1.3s)
  [PASS]  test/unit/test_auth_security.py                               (4.0s)
  [PASS]  test/unit/test_chunker.py                                     (0.5s)
  [PASS]  test/unit/test_citation_validator.py                          (0.3s)
  [PASS]  test/unit/test_code_executor_imports.py                       (0.3s)
  [PASS]  test/unit/test_code_security.py                               (0.4s)
  [PASS]  test/unit/test_config.py                                      (0.5s)
  [PASS]  test/unit/test_context_builder.py                             (0.7s)
  [PASS]  test/unit/test_core_utils.py                                  (0.3s)
  [PASS]  test/unit/test_file_detector.py                               (0.3s)
  [PASS]  test/unit/test_file_validator.py                              (0.4s)
  [PASS]  test/unit/test_performance_logger.py                          (0.6s)
  [PASS]  test/unit/test_rate_limiter.py                                (0.7s)
  [PASS]  test/unit/test_storage_service.py                             (0.5s)
  [PASS]  test/unit/test_token_counter.py                               (1.5s)
  [PASS]  test/integration/test_chromadb.py                             (2.3s)
  [FAIL]  test/integration/test_code_execution.py                       (6.0s)

    --- Failure output (last 30 lines) ---
    ___________________________ test_list_comprehension ____________________________
    test/integration/test_code_execution.py:78: in test_list_comprehension
        assert "0, 1, 4, 9, 16" in result.get("output", "").replace(" ", " ")
    E   AssertionError: assert '0, 1, 4, 9, 16' in ''
    E    +  where '' = <built-in method replace of str object at 0xa319e0>(' ', ' ')
    E    +    where <built-in method replace of str object at 0xa319e0> = ''.replace
    E    +      where '' = <built-in method get of dict object at 0x7480546cfe00>('output', '')
    E    +        where <built-in method get of dict object at 0x7480546cfe00> = {'chart_base64': None, 'elapsed': 0.32, 'error': None, 'exit_code': 0, ...}.get
    ___________________________ test_numpy_if_available ____________________________
    test/integration/test_code_execution.py:164: in test_numpy_if_available
        assert "6" in result.get("output", "")
    E   AssertionError: assert '6' in ''
    E    +  where '' = <built-in method get of dict object at 0x748050083500>('output', '')
    E    +    where <built-in method get of dict object at 0x748050083500> = {'chart_base64': None, 'elapsed': 0.31, 'error': None, 'exit_code': 0, ...}.get
    ___________________________ test_pandas_if_available ___________________________
    test/integration/test_code_execution.py:173: in test_pandas_if_available
        assert "(3, 1)" in result.get("output", "")
    E   AssertionError: assert '(3, 1)' in ''
    E    +  where '' = <built-in method get of dict object at 0x74803d2bc200>('output', '')
    E    +    where <built-in method get of dict object at 0x74803d2bc200> = {'chart_base64': None, 'elapsed': 0.49, 'error': None, 'exit_code': 0, ...}.get
    =========================== short test summary info ============================
    FAILED test/integration/test_code_execution.py::test_hello_world - AssertionE...
    FAILED test/integration/test_code_execution.py::test_math_computation - Asser...
    FAILED test/integration/test_code_execution.py::test_multiline_code - Asserti...
    FAILED test/integration/test_code_execution.py::test_import_math - AssertionE...
    FAILED test/integration/test_code_execution.py::test_import_json - assert '"a...
    FAILED test/integration/test_code_execution.py::test_list_comprehension - Ass...
    FAILED test/integration/test_code_execution.py::test_numpy_if_available - Ass...
    FAILED test/integration/test_code_execution.py::test_pandas_if_available - As...
    8 failed, 9 passed in 5.63s

  [FAIL]  test/integration/test_storage_integration.py                  (0.4s)

    --- Failure output (last 30 lines) ---
    ...F........                                                             [100%]
    =================================== FAILURES ===================================
    _________________ TestSaveLoadRoundTrip.test_binary_safe_text __________________
    test/integration/test_storage_integration.py:68: in test_binary_safe_text
        assert loaded == text
    E   AssertionError: assert 'Line1\n\nLin...ine3\x0bLine4' == 'Line1\n\rLin...ine3\x0bLine4'
    E     
    E       Line1
    E     - 
    E     + 
    E     - Line2
    E     ?      -
    E     + Line2...
    E     
    E     ...Full output truncated (3 lines hidden), use '-vv' to show
    =========================== short test summary info ============================
    FAILED test/integration/test_storage_integration.py::TestSaveLoadRoundTrip::test_binary_safe_text
    1 failed, 11 passed in 0.12s

  [FAIL]  test/integration/test_text_processing_pipeline.py             (0.4s)

    --- Failure output (last 30 lines) ---
    test/integration/test_text_processing_pipeline.py:73: in test_very_long_document_chunks_many
        text = (_IAAS_WHAT_IS + _IAAS_CHARACTERISTICS + _IAAS_LICENSING + _IAAS_VIRTUALIZATION) * 20
                ^^^^^^^^^^^^^
    E   NameError: name '_IAAS_WHAT_IS' is not defined
    _______________ TestChunkerIntegration.test_chunk_ids_all_unique _______________
    test/integration/test_text_processing_pipeline.py:119: in test_chunk_ids_all_unique
        text = (_IAAS_WHAT_IS + _IAAS_VIRTUALIZATION) * 200
                ^^^^^^^^^^^^^
    E   NameError: name '_IAAS_WHAT_IS' is not defined
    _______ TestChunkerIntegration.test_chunk_indices_zero_based_sequential ________
    test/integration/test_text_processing_pipeline.py:125: in test_chunk_indices_zero_based_sequential
        text = (_IAAS_CHARACTERISTICS + _IAAS_LICENSING) * 200
                ^^^^^^^^^^^^^^^^^^^^^
    E   NameError: name '_IAAS_CHARACTERISTICS' is not defined
    _________ TestChunkerIntegration.test_no_chunk_exceeds_reasonable_size _________
    test/integration/test_text_processing_pipeline.py:133: in test_no_chunk_exceeds_reasonable_size
        text = _IAAS_MARKDOWN_DOC * 5
               ^^^^^^^^^^^^^^^^^^
    E   NameError: name '_IAAS_MARKDOWN_DOC' is not defined
    =========================== short test summary info ============================
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_plain_text_chunks_produced
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_chunks_cover_text_content
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_markdown_text_pipeline
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_csv_text_pipeline
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_chunk_pipeline_preserves_all_chunks_consistent
    FAILED test/integration/test_text_processing_pipeline.py::TestPlainTextPipeline::test_very_long_document_chunks_many
    FAILED test/integration/test_text_processing_pipeline.py::TestChunkerIntegration::test_chunk_ids_all_unique
    FAILED test/integration/test_text_processing_pipeline.py::TestChunkerIntegration::test_chunk_indices_zero_based_sequential
    FAILED test/integration/test_text_processing_pipeline.py::TestChunkerIntegration::test_no_chunk_exceeds_reasonable_size
    9 failed, 5 passed in 0.12s

  [FAIL]  test/api/test_auth_api.py                                     (2.3s)

    --- Failure output (last 30 lines) ---
    ......F........                                                          [100%]
    =================================== FAILURES ===================================
    _____________ TestSignupSuccess.test_successful_signup_returns_201 _____________
    test/api/test_auth_api.py:119: in test_successful_signup_returns_201
        assert r.status_code == 201
    E   assert 200 == 201
    E    +  where 200 = <Response [200 OK]>.status_code
    =============================== warnings summary ===============================
    .venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
        from crypt import crypt as _crypt
    
    .venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:291
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
        warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
    
    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
    =========================== short test summary info ============================
    FAILED test/api/test_auth_api.py::TestSignupSuccess::test_successful_signup_returns_201
    1 failed, 14 passed, 2 warnings in 1.68s

  [FAIL]  test/api/test_health_api.py                                   (1.4s)

    --- Failure output (last 30 lines) ---
                          ^^^^^^^^^^^^^^^^^^^
    /usr/lib/python3.11/unittest/mock.py:1419: in get_original
        raise AttributeError(
    E   AttributeError: <module 'app.routes.health' from '/disk2/Projects/KeplerLab-AI-Notebook/backend/app/routes/health.py'> does not have the attribute 'get_collection'
    ______ TestHealthResponseStructure.test_healthy_system_returns_200_or_503 ______
    test/api/test_health_api.py:100: in test_healthy_system_returns_200_or_503
        assert r.status_code in (200, 503, 401)
    E   assert 500 in (200, 503, 401)
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    ________________ TestHealthAllComponentsMocked.test_all_healthy ________________
    test/api/test_health_api.py:111: in test_all_healthy
        with patch("app.routes.health.get_current_user", new=AsyncMock(return_value=_fake_user)), \
    /usr/lib/python3.11/unittest/mock.py:1446: in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
    /usr/lib/python3.11/unittest/mock.py:1419: in get_original
        raise AttributeError(
    E   AttributeError: <module 'app.routes.health' from '/disk2/Projects/KeplerLab-AI-Notebook/backend/app/routes/health.py'> does not have the attribute 'prisma'
    =============================== warnings summary ===============================
    .venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
        from crypt import crypt as _crypt
    
    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
    =========================== short test summary info ============================
    FAILED test/api/test_health_api.py::TestHealthAuthentication::test_no_token_returns_401
    FAILED test/api/test_health_api.py::TestHealthResponseStructure::test_health_response_has_required_keys
    FAILED test/api/test_health_api.py::TestHealthResponseStructure::test_healthy_system_returns_200_or_503
    FAILED test/api/test_health_api.py::TestHealthAllComponentsMocked::test_all_healthy
    4 failed, 1 passed, 1 warning in 0.83s

  [FAIL]  test/api/test_jobs_api.py                                     (1.4s)

    --- Failure output (last 30 lines) ---
    _________________________ test_all_job_types[podcast] __________________________
    test/api/test_jobs_api.py:147: in test_all_job_types
        assert r.status_code == 200
    E   assert 500 == 200
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    _______________________ test_all_job_types[presentation] _______________________
    test/api/test_jobs_api.py:147: in test_all_job_types
        assert r.status_code == 200
    E   assert 500 == 200
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    =============================== warnings summary ===============================
    .venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
        from crypt import crypt as _crypt
    
    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
    =========================== short test summary info ============================
    FAILED test/api/test_jobs_api.py::test_jobs_no_token_401 - assert 403 == 401
    FAILED test/api/test_jobs_api.py::test_job_not_found_404 - assert 500 == 404
    FAILED test/api/test_jobs_api.py::test_job_status_completed - assert 500 == 200
    FAILED test/api/test_jobs_api.py::test_all_job_statuses[pending] - assert 500...
    FAILED test/api/test_jobs_api.py::test_all_job_statuses[processing] - assert ...
    FAILED test/api/test_jobs_api.py::test_all_job_statuses[completed] - assert 5...
    FAILED test/api/test_jobs_api.py::test_all_job_statuses[failed] - assert 500 ...
    FAILED test/api/test_jobs_api.py::test_all_job_types[material_processing] - a...
    FAILED test/api/test_jobs_api.py::test_all_job_types[flashcard] - assert 500 ...
    FAILED test/api/test_jobs_api.py::test_all_job_types[quiz] - assert 500 == 200
    FAILED test/api/test_jobs_api.py::test_all_job_types[podcast] - assert 500 ==...
    FAILED test/api/test_jobs_api.py::test_all_job_types[presentation] - assert 5...
    12 failed, 4 passed, 1 warning in 0.83s

  [FAIL]  test/api/test_notebook_api.py                                 (1.4s)

    --- Failure output (last 30 lines) ---
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    ____________ TestDeleteNotebook.test_delete_nonexistent_returns_404 ____________
    test/api/test_notebook_api.py:179: in test_delete_nonexistent_returns_404
        assert r.status_code == 404
    E   assert 500 == 404
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    =============================== warnings summary ===============================
    .venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
        from crypt import crypt as _crypt
    
    .venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:291
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/pydantic/_internal/_config.py:291: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.9/migration/
        warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)
    
    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
    =========================== short test summary info ============================
    FAILED test/api/test_notebook_api.py::TestNotebookAuth::test_create_no_token_401
    FAILED test/api/test_notebook_api.py::TestNotebookAuth::test_list_no_token_401
    FAILED test/api/test_notebook_api.py::TestNotebookAuth::test_get_no_token_401
    FAILED test/api/test_notebook_api.py::TestCreateNotebook::test_create_notebook_201
    FAILED test/api/test_notebook_api.py::TestCreateNotebook::test_create_empty_name_422
    FAILED test/api/test_notebook_api.py::TestCreateNotebook::test_create_missing_name_422
    FAILED test/api/test_notebook_api.py::TestCreateNotebook::test_create_with_description
    FAILED test/api/test_notebook_api.py::TestListNotebooks::test_list_returns_200
    FAILED test/api/test_notebook_api.py::TestGetNotebook::test_get_existing_returns_200
    FAILED test/api/test_notebook_api.py::TestGetNotebook::test_get_nonexistent_returns_404
    FAILED test/api/test_notebook_api.py::TestDeleteNotebook::test_delete_existing_returns_200_or_204
    FAILED test/api/test_notebook_api.py::TestDeleteNotebook::test_delete_nonexistent_returns_404
    12 failed, 3 passed, 2 warnings in 0.80s

  [FAIL]  test/api/test_upload_api.py                                   (2.0s)

    --- Failure output (last 30 lines) ---
    E   assert 403 == 401
    E    +  where 403 = <Response [403 Forbidden]>.status_code
    ____________ TestDeleteMaterial.test_delete_material_not_found_404 _____________
    test/api/test_upload_api.py:140: in test_delete_material_not_found_404
        assert r.status_code in (404, 200)  # depends on implementation
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    E   assert 500 in (404, 200)
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    _______________ TestDeleteMaterial.test_delete_material_success ________________
    test/api/test_upload_api.py:148: in test_delete_material_success
        assert r.status_code in (200, 204)
    E   assert 500 in (200, 204)
    E    +  where 500 = <Response [500 Internal Server Error]>.status_code
    =============================== warnings summary ===============================
    .venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854
      /disk2/Projects/KeplerLab-AI-Notebook/.venv/lib/python3.11/site-packages/passlib/utils/__init__.py:854: DeprecationWarning: 'crypt' is deprecated and slated for removal in Python 3.13
        from crypt import crypt as _crypt
    
    -- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
    =========================== short test summary info ============================
    FAILED test/api/test_upload_api.py::TestUploadAuth::test_upload_no_token_401
    FAILED test/api/test_upload_api.py::TestUploadAuth::test_upload_url_no_token_401
    FAILED test/api/test_upload_api.py::TestUploadAuth::test_upload_text_no_token_401
    FAILED test/api/test_upload_api.py::TestGetMaterials::test_get_materials_no_token_401
    FAILED test/api/test_upload_api.py::TestUploadText::test_upload_text_missing_text_422
    FAILED test/api/test_upload_api.py::TestUploadText::test_upload_text_empty_text_422
    FAILED test/api/test_upload_api.py::TestDeleteMaterial::test_delete_material_no_auth_401
    FAILED test/api/test_upload_api.py::TestDeleteMaterial::test_delete_material_not_found_404
    FAILED test/api/test_upload_api.py::TestDeleteMaterial::test_delete_material_success
    9 failed, 2 passed, 1 warning in 1.19s

  [FAIL]  test/e2e/test_agent_pipeline.py                               (2.0s)

    --- Failure output (last 30 lines) ---
    E     - FILE_GENERATION
    E     + DATA_ANALYSIS
    _ TestAgentRoutingFlow.test_routing[Generate flashcards from my notes-CONTENT_GENERATION] _
    test/e2e/test_agent_pipeline.py:279: in test_routing
        assert result["intent"] == expected_intent, (
    E   AssertionError: 'Generate flashcards from my notes' → expected CONTENT_GENERATION, got QUESTION
    E   assert 'QUESTION' == 'CONTENT_GENERATION'
    E     
    E     - CONTENT_GENERATION
    E     + QUESTION
    ------------------------------ Captured log call -------------------------------
    WARNING  app.services.agent.intent:intent.py:168 [intent] LLM fallback failed, keeping keyword result: Event loop is closed
    _ TestAgentRoutingFlow.test_routing[Create a CSV report of the data-FILE_GENERATION] _
    test/e2e/test_agent_pipeline.py:279: in test_routing
        assert result["intent"] == expected_intent, (
    E   AssertionError: 'Create a CSV report of the data' → expected FILE_GENERATION, got DATA_ANALYSIS
    E   assert 'DATA_ANALYSIS' == 'FILE_GENERATION'
    E     
    E     - FILE_GENERATION
    E     + DATA_ANALYSIS
    =========================== short test summary info ============================
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_code_execution_messages_classified_correctly[Execute this Python function]
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_content_generation_messages_classified_correctly[Create flashcards from my notes]
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_content_generation_messages_classified_correctly[Make me some flashcards]
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_file_generation_messages_classified_correctly[Create a CSV file with the results]
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_file_generation_messages_classified_correctly[Export the data as Excel]
    FAILED test/e2e/test_agent_pipeline.py::TestKeywordIntentClassification::test_file_generation_messages_classified_correctly[Create a spreadsheet with this data]
    FAILED test/e2e/test_agent_pipeline.py::TestAgentRoutingFlow::test_routing[Generate flashcards from my notes-CONTENT_GENERATION]
    FAILED test/e2e/test_agent_pipeline.py::TestAgentRoutingFlow::test_routing[Create a CSV report of the data-FILE_GENERATION]
    8 failed, 40 passed in 1.26s

  [PASS]  test/e2e/test_generation_pipeline.py                          (2.2s)
  [PASS]  test/e2e/test_rag_pipeline.py                                 (2.6s)
  [FAIL]  test/e2e/test_upload_pipeline.py                              (2.6s)

    --- Failure output (last 30 lines) ---
    E   KeyError: 'iaas_billing'
    ____________ TestStage2Chunking.test_chunks_cover_original_content _____________
    test/e2e/test_upload_pipeline.py:120: in test_chunks_cover_original_content
        text = SAMPLE_DOCUMENTS["iaas_fundamentals"]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    E   KeyError: 'iaas_fundamentals'
    ___________ TestStage2Chunking.test_chunk_ids_unique_across_document ___________
    test/e2e/test_upload_pipeline.py:131: in test_chunk_ids_unique_across_document
        chunks = chunk_text(SAMPLE_DOCUMENTS["iaas_fundamentals"])
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    E   KeyError: 'iaas_fundamentals'
    _______________ TestStage3Embedding.test_embed_science_document ________________
    test/e2e/test_upload_pipeline.py:147: in test_embed_science_document
        chunks = chunk_text(SAMPLE_DOCUMENTS["iaas_fundamentals"])
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    E   KeyError: 'iaas_fundamentals'
    ____________ TestStage4FullPipeline.test_full_pipeline_science_doc _____________
    test/e2e/test_upload_pipeline.py:192: in test_full_pipeline_science_doc
        text = SAMPLE_DOCUMENTS["iaas_fundamentals"]
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    E   KeyError: 'iaas_fundamentals'
    =========================== short test summary info ============================
    FAILED test/e2e/test_upload_pipeline.py::TestStage1TextStorage::test_save_and_retrieve_text
    FAILED test/e2e/test_upload_pipeline.py::TestStage2Chunking::test_science_document_produces_multiple_chunks
    FAILED test/e2e/test_upload_pipeline.py::TestStage2Chunking::test_history_document_chunks_have_section_titles
    FAILED test/e2e/test_upload_pipeline.py::TestStage2Chunking::test_chunks_cover_original_content
    FAILED test/e2e/test_upload_pipeline.py::TestStage2Chunking::test_chunk_ids_unique_across_document
    FAILED test/e2e/test_upload_pipeline.py::TestStage3Embedding::test_embed_science_document
    FAILED test/e2e/test_upload_pipeline.py::TestStage4FullPipeline::test_full_pipeline_science_doc
    7 failed, 6 passed in 1.90s


======================================================================
SUMMARY: 18 passed, 10 failed  |  total time: 39.2s
======================================================================